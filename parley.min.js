!function e(t,s,i){function n(r,a){if(!s[r]){if(!t[r]){var l="function"==typeof require&&require;if(!a&&l)return l(r,!0);if(o)return o(r,!0);throw new Error("Cannot find module '"+r+"'")}var c=s[r]={exports:{}};t[r][0].call(c.exports,function(e){var s=t[r][1][e];return n(s?s:e)},c,c.exports,e,t,s,i)}return s[r].exports}for(var o="function"==typeof require&&require,r=0;r<i.length;r++)n(i[r]);return n}({1:[function(e,t){var s,n,o,r,a,l,c,p;s=e("jquery"),p="socket.io",o=e("./chat_room_view.coffee"),r=e("./command_center_view.coffee"),a=e("./conversation_model.coffee"),c=e("./user_model.coffee"),l=e("./oauth.coffee"),n=function(){function e(){this.current_users=[],this.open_conversations=[],this.conversations=[],this.server.on("persistent_convo",this.load_persistent_convo),this.server.on("current_users",this.load_current_users),this.server.on("user_logged_on",this.user_logged_on),this.server.on("user_logged_off",this.user_logged_off),function(){var e,t;return e=document.createElement("script"),e.type="text/javascript",e.async=!0,e.src="https://apis.google.com/js/client:plusone.js",t=document.getElementsByTagName("script")[0],t.parentNode.insertBefore(e,t)}(),this.command_center=new r,this.oauth=new l}return e.prototype.server=p.connect("wss://"+window.location.hostname),e.prototype.load_persistent_convo=function(e,t){var s,i,n,o,r;for(i=e.split(","),o=0,r=i.length;r>o;o++)n=i[o],n!==this.app.me.image_url&&(convo_partners+=n);return s=new a(convo_partners,t),this.conversations.push(s)},e.prototype.load_current_users=function(e){var t,s,n,o,r;for(this.current_users=e,o=this.current_users,r=[],s=0,n=o.length;n>s;s++)t=o[s],r.push(t.image_url===this.me.image_url?this.current_users.splice(i,1):void 0);return r},e.prototype.user_logged_on=function(e,t){var s;return s=new c(e,t),this.current_users.push(s)},e.prototype.user_logged_off=function(e,t){var s,n,o,r,a;for(r=this.current_users,a=[],n=0,o=r.length;o>n;n++)s=r[n],a.push(t===s.image_url?this.current_users.splice(i,1):void 0);return a},e}(),t.exports=new n},{"./chat_room_view.coffee":2,"./command_center_view.coffee":3,"./conversation_model.coffee":4,"./oauth.coffee":7,"./user_model.coffee":9,jquery:"HlZQrA"}],2:[function(e,t){var s,n,o,r,a,l;s=e("jquery"),l=e("./app.coffee"),r=e("./message_model.coffee"),a=e("./message_view.coffee"),o=e("./conversation_model.coffee"),n=function(){function e(e){this.convo=e,this.render(),s("body").append(this.$element),l.server.on("message",this.message_callback),l.server.on("user_offline",this.user_offline_callback),l.server.on("typing_notification",this.typing_notification_callback),this.$element.find(".chat-close").on("click",this.closeWindow),this.$element.find(".send").on("keypress",this.sendOnEnter),this.$element.find(".send").on("keyup",this.emitTypingNotification),this.$element.find(".top-bar, minify ").on("click",this.toggleChat),this.$element.on("click",this.removeNotifications),this.$discussion.find(".parley_file_upload").on("change",this.file_upload)}return e.prototype.chat_room_template=Handlebars.compile('<div class="parley"> <section class="conversation"> <div class="top-bar"> <a>{{first_name}}</a> <ul class="message-alt"> <li class="entypo-minus minify"></li> <li class="entypo-resize-full"></li> <li class="entypo-cancel chat-close"></li> </ul> </div> <div class="message-bar"> <ul class="additional"> <li><a class="entypo-user-add"></a></li> <li><a class="fontawesome-facetime-video"></a></li> </ul> <ul class="existing"> <li><a class="entypo-chat"></a></li> </ul> </div> <ol class="discussion"></ol> <textarea class="grw" placeholder="Enter Message..."></textarea> <label class="img_upload entypo-camera"> <span> <input class="parley_file_upload" name="img_upload" type="file" /></label> </span> </section> </div>'),e.prototype.message_callback=function(e){return this.convo.add_message(e),this.renderDiscussion(),this.$element.find(".top-bar").addClass("new-message"),this.titleAlert()},e.prototype.user_offline_callback=function(){var e;return e=new r(l.me,"http://storage.googleapis.com/parley-assets/server_network.png","This user is no longer online",new Date),this.convo.add_message(e),this.renderDiscussion()},e.prototype.typing_notification_callback=function(e,t,s){var i;if(e===this.convo.message_filter){if(!s)return this.$discussion.find(".incoming").remove(),this.scrollToLastMessage();if(0===this.$discussion.find(".incoming").length)return i="<li class='incoming'><div class='avatar'><img src='"+t.image_url+"'/></div><div class='messages'><p>"+t.display_name+" is typing...</p></div></li>",that.$(".discussion").append(typingNotification),this.$discussion.append(i),this.scrollToLastMessage()}},e.prototype.add_member=function(e){var t,s,n,r,a,c;for(n=this.convo.convo_partners.concat(e),s=new o(n),l.conversations.push(s),c=l.open_conversations,r=0,a=c.length;a>r;r++)t=c[r],t===this.convo.message_filter&&l.open_conversations.splice(i,1);return l.open_conversations.push(s.message_filter),this.convo=s,this.render()},e.prototype.render=function(){return this.$element=s(this.chat_room_template(this.convo)),this.$discussion=this.$element.find(".discussion")},e.prototype.renderDiscussion=function(){var e;return e=this.convo.messages.slice(-1)[0],this.appendMessage(e),this.scrollToLastMessage()},e.prototype.appendMessage=function(e){var t;return t=new MesssageView(e),t.render(),this.$discussion.append(t.$element)},e.prototype.scrollToLastMessage=function(){return this.$discussion.scrollTop(this.$discussion.find("li:last-child").offset().top+this.$discussion.scrollTop())},e.prototype.loadPersistentMessages=function(){var e,t,s,i;for(i=this.convo.messages,t=0,s=i.length;s>t;t++)e=i[t],this.appendMessage(e);return this.messages.length>0?this.scrollToLastMessage():void 0},e.prototype.sendOnEnter=function(e){return 13===e.keyCode?(this.sendMessage(),this.removeNotifications()):void 0},e.prototype.sendMessage=function(){var e;return e=new r(this.convo.convo_partners,l.me,this.$element.find(".send").val()),this.messages.add(send),this.renderDiscussion(),l.server.emit("mesage",e),this.$discussion.find(".send").val(""),this.emitTypingNotification()},e.prototype.toggle_convo=function(e){return e.preventDefault(),this.$discussion.toggle(),this.$discussion.attr("display")===!1?this.scrollToLastMessage:void 0},e.prototype.closeWindow=function(e){return e.preventDefault(),e.stopPropagation(),l.server.removeAllListeners(),this.$element.find(".chat-close").off(),this.$element.find(".send").off(),this.$element.find(".send").off(),this.$element.find(".top-bar").off(),this.$element.off(),this.$discussion.off(),this.$element.remove(),delete this},e.prototype.removeNotifications=function(){return this.$element.find(".top-bar").removeClass("new-message"),l.title_notification.notified?this.clearTitleNotification():void 0},e.prototype.emitTypingNotification=function(){return""!==this.$element.find(".send").val()?l.server.emit("user_typing",this.convo.convo_partners_image_urls,l.me,!0):l.server.emit("user_typing",this.convo.convo_partners_image_urls,l.me,!1)},e.prototype.clearTitleNotification=function(){return l.clearAlert(),s("html title").html(l.title_notification.page_title),l.title_notification.notified=!1},e.prototype.titleAlert=function(){var e,t,i,n;return l.title_notification.notified?void 0:(t=this.convo.messages[-1].sender.display_name,e="Pending ** "+t,i=function(){return s("html title").html(s("html title").html()===l.title_notification.page_title?e:l.title_notification.page_title)},n=setInterval(i,2200),l.clear_alert=function(){return clearInterval(n)},l.title_notification.notified=!0)},e.prototype.file_upload=function(){var e;return e=this.$discussion.find(".picture_upload").get(0).files[0],l.oauth.file_upload(e,this.convo.convo_partners_image_urls,l.me.image_url)},e}(),t.exports=n},{"./app.coffee":1,"./conversation_model.coffee":4,"./message_model.coffee":5,"./message_view.coffee":6,jquery:"HlZQrA"}],3:[function(e,t){var s,i,n,o,r;s=e("jquery"),r=e("./app.coffee"),o=e("./user_view.coffee"),n=e("./persistent_conversation_view.coffee"),i=function(){function e(){this.menu=null,s("body").append(logged_out_view()),s("ul.login-bar").hide(),s(".parley .persistent-bar.logged-out").on("click",function(){return s("ul.login-bar").toggle()})}return e.prototype.logged_out_view=Handlebars.compile('<div class="parley"> <section class="controller"> <div class="controller-view"></div> <ul class="login-bar g-signin" data-callback="sign_in_callback" data-clientid= data-cookiepolicy="single_host_origin" data-theme="none" data-scope="https://www.googleapis.com/auth/plus.login https://www.googleapis.com/auth/devstorage.read_write"> <li class="btn"> <a class="entypo-gplus"></a> </li> <li class="aside"> <a>| Sign in with google</a> </li> <div class="persistent-bar parley-logged-out"> <a id="log-click"> click here to login!</a> <span class="fontawesome-reorder"></span> </div> </ul> </section> </div>'),e.prototype.logged_in_view=Handlebars.compile('<div class="controller-view"> <div class="default-view"> <figure> <img src={{image_url}}/> <h2>{{me.display_name}}</h2> </figure> </div> </div> <div class="controller-bar"> <ul class="utility-bar horizontal-list"> <li> <a class="messages" href="#"> <span class="entypo-chat"></span> </a> </li> <li> <a class="active-users" href="#"> <span class="entypo-users"></span> </a> </li> <li> <a class="user-settings" href="#"> <span class="fontawesome-cog"></span> </a> </li> </ul> <div class="persistent-bar"> <a>{{display_name}}</a> <span class="fontawesome-reorder"></span> </div> </div>'),e.prototype.log_in=function(){return s(".parley .persistent-bar.logged_out").off(),this.$element=logged_in_view(r.me),s(".parley section.controller").html(this.$element),s(".parley div.controller-bar a.messages").on("click",this.toggle_persistent_convos),s(".parley div.controller-bar a.active_users").on("click",this.toggle_current_users),s(".parley div.controller-bar a.user-settings").on("click",this.toggle_user_settings)},e.prototype.toggle_command_center=function(){return logged_out?s(".parley .persistent-bar.logged-out").on("click",function(){return s("#log-click").toggle(),s("ul.login-bar").slideToggle()}):s(function(){return s(".persistent-bar").on("click",function(){return s(".controller-view").toggle()})})},e.prototype.toggle_current_users=function(){var e,t,i,n,a,l;if(this.menu===!1){for(s(".parley div.controller-view").children().remove(),a=r.current_users,l=[],i=0,n=a.length;n>i;i++)e=a[i],t=new o(e),l.push(s(".parley div.controller-view").append(t.render()));return l}return s(".parley div.controller-view").children().remove(),s(".parley div.controller-view").html(logged_in_view(r.me))},e.prototype.toggle_persistent_convos=function(){var e,t,i,o,a,l;if(this.menu===!1){for(s(".parley div.controller-view").children().remove(),a=r.conversations,l=[],i=0,o=a.length;o>i;i++)e=a[i],t=new n(e),l.push(s(".parley div.controller-view").append(t.render()));return l}return s(".parley div.controller-view").children().remove(),s(".parley div.controller-view").html(logged_in_view(r.me))},e.prototype.toggle_user_settings=function(){},e}(),t.exports=i},{"./app.coffee":1,"./persistent_conversation_view.coffee":8,"./user_view.coffee":10,jquery:"HlZQrA"}],4:[function(e,t){var s,n,o;s=e("jquery"),o=e("./app.coffee"),n=function(){function e(e,t){var s,n,o,r,a;for(this.convo_partners=e,this.messages=null!=t?t:[],this.generate_message_filter(),this.first_name_list="",this.convo_partners_image_urls=[],a=this.convo_partners,o=0,r=a.length;r>o;o++)n=a[o],s=n.display_name.match(/\A.+\s/)[0],i!==this.convo_partners.length?(this.first_name_list+=""+s+", ",this.convo_partners_image_urls+=n.image_url):(this.first_name_list+=""+s,this.convo_partners_image_urls+=n.image_url)}return e.prototype.add_message=function(e){return this.messages.push(e)},e.prototype.generate_message_filter=function(){var e,t,s,i;for(this.message_filter=[o.me.image_url],i=this.convo_partners,t=0,s=i.length;s>t;t++)e=i[t],this.message_filter.push(e.image_url);return this.message_filter.sort().join()},e}(),t.exports=n},{"./app.coffee":1,jquery:"HlZQrA"}],5:[function(e,t){var s,i,n;s=e("jquery"),n=e("./app.coffee"),i=function(){function e(e,t,s,i){this.recipients=e,this.sender=t,this.content=s,this.time_stamp=i,this.time_stamp||(this.time_stamp=(new Date).toUTCString()),this.convo_id=this.recipients.concat(this.sender).sort().join(),this.time_created=new Date(this.time_stamp)}return e.prototype.time_elapsed=function(){var e,t,s,i,n;return this.current_time=new Date,i=Math.floor((current_time-time_created)/6e4),current_time.getDate()===time_created.getDate()&&1440>i&&(n=!0),t=Math.floor(i/60),s=Math.floor(i%60),60>i?""+i+" mins ago":4>t?0===s?""+t+" hours ago":""+t+" hour "+s+" min ago":(e=this.date_formatter(),n?""+e.hour+":"+e.minutes+" "+e.suffix:""+e.month+" "+e.day+" | "+e.hour+":"+e.minutes+" "+e.suffix)},e.prototype.date_formatter=function(){var e,t,s,i,n,o,r;switch(this.time_created.getMonth()){case 0:o="Jan";break;case 1:o="Feb";break;case 2:o="Mar";break;case 3:o="Apr";break;case 4:o="May";break;case 5:o="Jun";break;case 6:o="Jul";break;case 7:o="Aug";break;case 8:o="Sep";break;case 9:o="Oct";break;case 10:o="Nov";break;case 11:o="Dec"}return t=this.time_created.getHours(),t>12?(r="PM",i=t-12):(r="AM",i=t),s=this.time_created.getMinutes(),n=10>s?"0"+s:""+s,e={month:o,day:this.time_created.getDate(),hour:i,minutes:n,suffix:r}},e}(),t.exports=i},{"./app.coffee":1,jquery:"HlZQrA"}],6:[function(e,t){var s,i,n;s=e("jquery"),n=e("./app.coffee"),i=function(){function e(e){this.message=e}return e.prototype.message_template=Handlebars.compile('<div class="avatar"> <img src="{{sender.image_url}}"/> <div class="message status"> <h2>{{sender.display_name}}</h2> <p>{{content}}</p> <a class="time"> <span class="entypo-clock">{{time_elapsed()}}</span> </a> </div>'),e.prototype.render=function(){return this.$element=this.message.sender.image_url===n.me.image_url?s('<li class="self"></li>').append(message_template(this.message)):s('<li class="other"></li>').append(message_template(this.message))},e}(),t.exports=i},{"./app.coffee":1,jquery:"HlZQrA"}],7:[function(e,t){var s,i,n;s=e("jquery"),n=e("./app.coffee"),i=function(){function e(){}return window.sign_in_callback=function(t){return t.status.signed_in?(gapi.client.load("plus","v1",function(){var e;return e=gapi.client.plus.people.get({userId:"me"}),e.execute(function(e){var t,s;return t=e.displayName,s=e.image.url,n.me=new User(t,s),n.server.emit("join",t,s),n.command_center.log_in()})}),e.file_upload=function(e,i,o){return s.ajax({url:"https://www.googleapis.com/upload/storage/v1beta2/b/parley-images/o?uploadType=media&name="+e.name,type:"POST",data:e,contentType:e.type,processData:!1,headers:{Authorization:"Bearer "+t.access_token},success:function(e){return function(t){var s,r,a;return s="https://storage.cloud.google.com/parley-images/"+t.name,a="<img src="+s+" />",n.server.emit("message",a,i,o),r=new Message(i,o,a),e.convo.messages.add_message(r),e.render()}}(this)})}):console.log("Sign-in state: "+t.error)},e}(),t.exports=i},{"./app.coffee":1,jquery:"HlZQrA"}],8:[function(e,t){var s,i,n,o;s=e("jquery"),o=e("./app.coffee"),i=e("./chat_room_view.coffee"),n=function(){function e(e){this.convo=e,this.$element.on("click",this.load_convo),{persistent_convo_template_reg:Handlebars.compile('<div class="message existing"> <div class="avatar"> <img src={{convo_partners[0].image_url}} /> </div> <div class="content status entypo-right-open-big"> <h2>{{convo_partner.display_name}}</h2> <p>{{messages[-1].content}}</p> <a class="time"> <span class="entypo-clock"> {{messages[-1].time_elapsed()}}</span> </a> </div> </div>'),render:function(){return this.$element=this.persistent_convo_template_reg(this.convo)},load_convo:function(){var t,s,n,r,a;for(s="closed",a=o.open_conversations,n=0,r=a.length;r>n;n++)e=a[n],this.convo.message_filter===e.message_filter&&(s="open");return"open"===s||(t=new i(this.convo),o.open_conversations.push(this.convo.message_filter),this.$element.parent()[0].hasClass("controller-view"))?void 0:this.$element.parents("div.parley").remove()}}}return e}(),t.exports=n},{"./app.coffee":1,"./chat_room_view.coffee":2,jquery:"HlZQrA"}],9:[function(e,t){var s,i,n;s=e("jquery"),n=e("./app.coffee"),i=function(){function e(e,t){this.display_name=e,this.image_url=t,this.status="active"}return e}(),t.exports=i},{"./app.coffee":1,jquery:"HlZQrA"}],10:[function(e,t){var s,i,n,o,r;s=e("jquery"),r=e("./app.coffee"),i=e("./chat_room_view.coffee"),n=e("./conversation_model.coffee"),o=function(){function e(e,t){this.current_user=e,this.chat_room=t,this.$element.on("click",this.user_interact_callback)}return e.prototype.current_user_template=Handlebars.compile('<li class="user"> <div class="avatar"> <img src={{image_url}} /> </div> <div class="content"> <h2>{{display_name}}</h2> </div> </li>'),e.prototype.render=function(){return this.$element=this.current_user_template(this.current_user)},e.prototype.user_interact_callback=function(){return this.$element.parent()[0].hasClass("controller-view")?this.open_conversation():this.chat_room.add_member(this.current_user)},e.prototype.open_conversation=function(){var e,t,s,o,a,l,c,p,u,f,m;for(a=[r.me.image_url,this.current_user.image_url].sort().join(),f=r.open_conversations,l=0,p=f.length;p>l;l++)if(s=f[l],a===s.message_filter)return;for(o=!1,m=r.conversations,c=0,u=m.length;u>c;c++)s=m[c],s.message_filter===a&&(o=!0);return o?(e=new i(s),r.open_conversations.push(a)):(t=new n([this.current_user]),e=new i(t),r.conversations.push(t),r.open_conversations.push(a))},e}(),t.exports=o},{"./app.coffee":1,"./chat_room_view.coffee":2,"./conversation_model.coffee":4,jquery:"HlZQrA"}]},{},[1]);